<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Behind the Shanghaai¬¥s Shikumen</title>
    <link rel="icon" type="image/x-icon" href="img/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-aFq/bzH65dt+w6FI2ooMVUpc+21e0SRygnTpmBvdBgSdnuTN7QbdgL+OapgHtvPp" crossorigin="anonymous" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <!-- Google Fonts - Roboto con todos los pesos necesarios -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="style.css" rel="stylesheet" />
    <style>
        /* Estilos para el bot√≥n de control de audio en la imagen grande */
        .image-section.full-width-image-section {
            position: relative;
        }
        
        /* Contenedor principal de audio */
        .audio-control-container {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            z-index: 100;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }
        
        .audio-control-container.visible {
            opacity: 1;
            transform: translateY(0);
            pointer-events: all;
        }
        
        /* Bot√≥n de audio con color cyan y animaci√≥n */
        .section-audio-control {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: linear-gradient(135deg, #00bcd4, #0097a7);
            color: white;
            border: 2px solid rgba(255, 255, 255, 0.8);
            cursor: pointer;
            box-shadow: 0 4px 15px rgba(0, 188, 212, 0.4);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        /* Animaci√≥n tenue de pulso */
        .section-audio-control::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.2);
            animation: gentlePulse 2s infinite ease-in-out;
            z-index: -1;
        }
        
        @keyframes gentlePulse {
            0%, 100% { transform: scale(1); opacity: 0.3; }
            50% { transform: scale(1.05); opacity: 0.5; }
        }
        
        .section-audio-control:hover {
            background: linear-gradient(135deg, #00acc1, #00838f);
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(0, 188, 212, 0.6);
        }
        
        .section-audio-control.muted {
            background: linear-gradient(135deg, #78909c, #546e7a);
            box-shadow: 0 4px 15px rgba(120, 144, 156, 0.4);
        }
        
        .section-audio-control.muted::before {
            animation: none;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .section-audio-control.muted:hover {
            background: linear-gradient(135deg, #607d8b, #455a64);
            box-shadow: 0 6px 20px rgba(120, 144, 156, 0.6);
        }
        
        /* Texto al lado del bot√≥n */
        .audio-control-text {
            background-color: rgba(255, 255, 255, 0.95);
            color: #333;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 500;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.15);
            white-space: nowrap;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        /* Indicador de audio activo */
        .audio-indicator {
            position: absolute;
            top: 20px;
            left: 20px;
            background-color: rgba(0, 188, 212, 0.9);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-size: 14px;
            z-index: 100;
            box-shadow: 0 2px 10px rgba(0, 188, 212, 0.3);
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(-10px);
            transition: opacity 0.5s ease, transform 0.5s ease;
            pointer-events: none;
        }
        
        .audio-indicator.visible {
            opacity: 1;
            transform: translateY(0);
        }
        
        .audio-indicator .pulse {
            width: 10px;
            height: 10px;
            background-color: #4CAF50;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.2); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        
        /* Para dispositivos m√≥viles */
        @media (max-width: 768px) {
            .audio-control-container {
                top: 15px;
                right: 15px;
                gap: 8px;
            }
            
            .section-audio-control {
                width: 45px;
                height: 45px;
                font-size: 18px;
            }
            
            .audio-control-text {
                font-size: 12px;
                padding: 6px 12px;
                white-space: normal;
                max-width: 120px;
            }
            
            .audio-indicator {
                top: 15px;
                left: 15px;
                font-size: 12px;
                padding: 6px 12px;
            }
        }
        
        @media (max-width: 480px) {
            .audio-control-text {
                display: none; /* Ocultar texto en m√≥viles muy peque√±os */
            }
        }
    </style>
</head>
<body>
    
    <!-- Video Hero Section -->
    <nav class="w-100 bg-primary fixed-top p-0 shadow-sm">
        <h6 class="text-center text-white p-1 m-0">China Daily Graphics</h6>
    </nav>
    
    <header>
        <img src="facade-top-m.jpg" alt="Hist√≥rico <i>shikumen</i> en Shangh√°i" class="d-md-none w-100">
        <img src="facade-top.jpg" alt="Hist√≥rico <i>shikumen</i> en Shangh√°i" class="d-none d-md-block w-100">
    </header>
    
    <!-- T√≠tulo e Introducci√≥n -->
    <section class="title-intro">
        <h1>Knocking on the stone door</h1>
        <p class="intro">
            The <i>shikumen</i> architectural style emerged in Shanghai during the foreign concessions period in the mid-19th century, as a creative response to the need for dense yet culturally appropriate housing. Its name, which literally translates to "stone gate," refers to the most distinctive element of these buildings: the carved stone frames that surround the main entrances.
        </p>
        <div class="info" align="center">
        <span class="info_l">
          By Jorge Cortes, Tian Chi, Yu Yilei, Li Xiaotian And Mukesh Mohanan / China Daily 
          <br>China Daily Graphics
          <br>Updated: 2026-02-02<br>
        </span>
    </div>
    </section>
    
    <!-- IMAGEN old-picture-shnaghai.jpg A TODO ANCHO -->
    <div class="full-width-image-container">
        <img src="old-picture-shnaghai.jpg" alt="Detalles constructivos Shikumen" class="w-100">
        <p class="image-caption">Between 1920s-1930s, <i>Shikumen</i> construction reached its zenith, with over 9,000 lanes estimated across the city. They housed more than 60% of Shanghai's population (millions of people), from factory workers and clerks to writers and revolutionaries</p>
    </div>
    
    <section class="title-intro">
        <p class="section-text">
            Discover the essence of traditional Chinese architecture reinterpreted for the 21st century. The <i>shikumen</i> house represents more than just a building style; it's a living testament to Shanghai's cultural history, elegantly adapting to modern needs while preserving its traditional soul.
        </p>   
        <video controls width="100%" poster="anim-compound-prev.jpg" muted>
            <source src="anim-compound01.mp4" type="video/mp4">
        </video>
        <p class="image-caption">This is an example of a <i>shikumen</i> house in Shanghai and its internal layout.</p>    
        <br>
        <p class="section-text">
            These residential complexes, known as "lilong," represented an innovative urban planning solution that combined the privacy of traditional Chinese single-family homes with the spatial efficiency of Western designs. Unlike traditional courtyard houses (siheyuan) that occupied large tracts of land, <i>shikumen</i> houses were organized along narrow streets (longtang) that maximized space utilization in a rapidly growing city.
        </p>   
        <object data="svg/sub-lane-image.svg" type="image/svg+xml" class="w-100"></object>
        
    </section>
    
    <!-- Imagen a todo ancho con Tooltips -->
    <section class="image-section full-width-image-section" id="mainImageSection">
        <!-- Audio espec√≠fico para esta secci√≥n -->
        <audio id="image-section-audio" loop>
            <source src="shikumen-background-sound.mp3" type="audio/mp3">
            Tu navegador no soporta el elemento de audio.
        </audio>
        
        <!-- Contenedor del control de audio -->
        <div id="audioControlContainer" class="audio-control-container">
            <!-- Bot√≥n de control de audio -->
            <button id="sectionAudioControlBtn" class="section-audio-control" title="Activar/desactivar audio ambiental">
                <i class="fas fa-volume-up"></i>
            </button>
            
            <!-- Texto al lado del bot√≥n -->
            <div class="audio-control-text">
                Activate ambient audio
            </div>
        </div>
        
        <!-- Indicador de audio activo -->
        <div id="audioIndicator" class="audio-indicator">
            <span class="pulse"></span>
            Audio ambiental activo
        </div>

        <img src="main-shikumen-clean.jpg" alt="The shikumen inside" class="d-md-none w-100">
        <video autoplay loop width="100%" poster="main-shikumen-clean.jpg" muted class="d-none d-md-block w-100">
            <source src="shikumen-live-ok.mp4" type="video/mp4">
        </video>        
        
        <!-- Marcadores con tooltips -->
        <div class="marker" style="top: 55%; left: 18%;" data-tooltip="1">
            <span>1</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Courtyard</h3>
                <p>A small, open-air space at the entrance. It provides light and ventilation to the front rooms and symbolizes a connection to nature, acting as a transitional buffer between the public lane and the private home.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 70%; left: 38%;" data-tooltip="2">
            <span>2</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Parlor</h3>
                <p>The formal reception room at the front, directly accessible from the courtyard. It's the most public room in the house, used for receiving guests, family gatherings, and ceremonies.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 33%; left: 37%;" data-tooltip="3">
            <span>3</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Upper living room</h3>
                <p>Located directly above the parlor on the first floor. It is the main living space for the family ‚Äîmore private than the parlor ‚Äî and typically houses the master bedroom or primary family sitting area.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 48%; left: 58%;" data-tooltip="4">
            <span>4</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Staircase</h3>
                <p>A narrow, often steep, wooden staircase connecting the floors. It is usually tucked away in a corner behind the parlor, leading to the upper living room, loft and garret.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 75%; left: 75%;" data-tooltip="5">
            <span>5</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Kitchen</h3>
                <p>Located at the very back of the ground floor, behind the central living areas. It is a functional, often compact, space that opens to the rear sub-lane, where many residents prefer to enter or exit the building.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 50%; left: 79%;" data-tooltip="6">
            <span>6</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Garret</h3>
                <p>A small, low-ceilinged room built on the mezzanine level between the first and second floors, often above the kitchen and facing the narrow rear alley. It was the least desirable space ‚Äîpoorly lit and ventilated ‚Äî and was historically rented out to students, writers, or artists at low cost.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 25%; left: 78%;" data-tooltip="7">
            <span>7</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Flat roof</h3>
                <p>It is the open-air terrace, typically located at the very back of the house on the second floor, adjacent to the garret. It was an essential multi-purpose utilitarian space.</p>
            </div>
        </div>
        
        <div class="marker" style="top: 20%; left: 44%;" data-tooltip="8">
            <span>8</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Loft</h3>
                <p>The attic space under the sloped roof, above the upper living room. Used for storage or as an extra, cramped sleeping area, accessible by a ladder or the final section of the staircase.</p>
            </div>
        </div>

         <div class="marker" style="top: 60%; left: 90%;" data-tooltip="9">
            <span>9</span>
            <div class="tooltip">
                <button class="tooltip-close">&times;</button>
                <h3>Sub-lane</h3>
                <p>The sub-lane is where the neighborhood comes alive. The <i>shikumen</i> lane functioned as the vital artery of a community, where every daily interaction, from a simple nod to a collective bargain, pulsed with the warm, bustling life of old Shanghai.</p>
            </div>
        </div>
    </section>

    <!-- Contenido Longform -->
    <div class="longform-container">
        <!-- Secci√≥n 1: Historia -->
        <section class="longform-section">
            <h2 class="section-title">Life in the <i>Shikumen</i></h2>
        </section>
        <p class="section-text">
                More than just an architectural icon of Shanghai, the shikumen houses formed the physical framework for a uniquely intimate urban life. The true spirit of this world was not confined within the individual homes, but thrived in the shared, narrow lanes (<i>longtang</i> ) that connected them.
            </p>
            <object data="svg/sub-lane-life.svg" type="image/svg+xml" class="w-100"></object>
             <p class="section-text">
                The <i>shikumen</i> lane functioned as the vital artery of a community, where every daily interaction, from a simple nod to a collective bargain, pulsed with the warm, bustling life of old Shanghai.
            </p>
            <p class="section-text">
                More than just an architectural icon of Shanghai, the shikumen houses formed the physical framework for a uniquely intimate urban life. The true spirit of this world was not confined within the individual homes, but thrived in the shared, narrow lanes (<i>longtang</i> ) that connected them.
            </p>
            <object data="svg/rear-facade-life.svg" type="image/svg+xml" class="w-100"></object>
             <p class="section-text">
                The <i>shikumen</i> lane functioned as the vital artery of a community, where every daily interaction, from a simple nod to a collective bargain, pulsed with the warm, bustling life of old Shanghai.
            </p>
    </div>
    
    <!-- IMAGEN FULL WIDTH DESPU√âS DEL T√çTULO -->
    <div class="longform-container">
        <!-- Secci√≥n 1: Historia -->
        <section class="longform-section">
            <h2 class="section-title">Once upon a time in the garret</i></h2>
        </section>
            <img src="garret-location.jpg" class="longform-image">
             <p class="section-text">
                Tingzijian, or garret, is a distinctive small compartment unique to shikumen buildings. It is denied access to the sun all year round and is cold in winter and hot in summer, but has long been favored by writers and intellectuals due to its relatively cheap rental and convenience. Many modern Chinese literary giants once lived in garrets.
            </p>
    </div>
    <article class="container-fluid">
                <object data="svg/famous-writers-m.svg" type="image/svg+xml" class="d-md-none w-100"></object>
                <object data="svg/famous-writers-d.svg" type="image/svg+xml" class="d-none d-md-block w-100"></object>
            </article>
    
    <div class="longform-container">
        <section class="longform-section">
            <h2 class="section-title">Stone gate</h2>
        </section>
         <p class="section-text">
                Shikumen literally translates to "stone gate" or "stone warehouse gate", and represents a fascinating fusion of Eastern and Western cultural influences.
            </p>
            <object data="svg/door-features.svg" type="image/svg+xml" class="w-100"></object>
        <p class="section-text">
                Some door designs
            </p>
        
        <!-- CARRUSEL DE ESTAD√çSTICAS (reemplaza la secci√≥n de estad√≠sticas) -->
        <section class="longform-section">
            <div id="statsCarousel" class="carousel slide" data-bs-ride="carousel">
                <div class="carousel-indicators">
                    <button type="button" data-bs-target="#statsCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
                    <button type="button" data-bs-target="#statsCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
                    <button type="button" data-bs-target="#statsCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
                    <button type="button" data-bs-target="#statsCarousel" data-bs-slide-to="3" aria-label="Slide 4"></button>
                </div>
                <div class="carousel-inner">
                    <div class="carousel-item active">
                        <div class="carousel-content">
                           <img src="door01.jpg" class="longform-image">
                            <p class="stat-description">No 913, Siming village, Yan'an Middle Road</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="carousel-content">
                            <img src="door02.jpg" class="longform-image">
                            <p class="stat-description">Registry of the Chinese Labour Group</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="carousel-content">
                            <img src="door03.jpg" class="longform-image">
                            <p class="stat-description">The former site of the Central Military Commission of the Communist Party of China</p>
                        </div>
                    </div>
                    <div class="carousel-item">
                        <div class="carousel-content">
                            <img src="door04.jpg" class="longform-image">
                            <p class="stat-description">Shanghai Zhangyuan garden </p>
                        </div>
                    </div>
                </div>
                <button class="carousel-control-prev" type="button" data-bs-target="#statsCarousel" data-bs-slide="prev">
                    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Anterior</span>
                </button>
                <button class="carousel-control-next" type="button" data-bs-target="#statsCarousel" data-bs-slide="next">
                    <span class="carousel-control-next-icon" aria-hidden="true"></span>
                    <span class="visually-hidden">Siguiente</span>
                </button>
            </div>
        </section>

        <p class="section-text">
                The stone door frames of shikumen buildings, paired with black-lacquered wooden doors, are often adorned with Baroque or traditional Chinese reliefs on the lintels.
            </p>
             
        <br><br>
        <!-- Secci√≥n 2: Dise√±o y Construcci√≥n -->
        <section class="longform-section">
            <h2 class="section-title">Some historic styles</h2>
            
            <p class="section-text">
                There are more than 2 million square meters or 1,900 units of relatively intact <i>shikumen</i> buildings remaining in Shanghai.
            </p>
             <object data="svg/3-designs.svg" type="image/svg+xml" class="w-100"></object>
            
            <footer class="container">
            <div class="row">
                <div class="col-9 col-sm-8 col-md-7 col-lg-6 mx-auto mt-5 mb-3 small text-muted text-center">
                   <p>Sources: Jie Li, <i>Shanghai homes</i>: Yang Kaijie Paper Art, <i>Exploring Shikumen</i>: Capella Shanghai: shanghaistreetstories.com
                        <br>ChinaDaily 2026</a></p>
                </div>
                <div class="row"> 
                        <div class="row">
                     <p><div class="col-10 col-sm-9 col-md-8 col-lg-7 mx-auto mt-6 mb-3 medium text-muted text-center"></br>
                   <span class="emoji">üëá</span>Open and download to print<span class="emoji">üëá</span></p>
                    </div>
                    <div class="col-12 col-sm-12 col-md-12 col-lg-12 mx-auto">
                        <a href="img/snowleopard-print-d.jpg" target="_blank"><img src="img/snowleopard-print-thumb.jpg" alt="Snowleopard China Daily infographic" class="w-100">
                        <div class="row"></a>
                    </div>
                </div>
            </div>
        </footer>

    <!-- Bootstrap JS Bundle con Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha2/dist/js/bootstrap.bundle.min.js" integrity="sha384-qKXV1j0HvMUeCBQ+QVp7JcfGl760yU08IQ+GpUo5hlbpg51QRiuqHAJz8+BrxE/N" crossorigin="anonymous"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // ==============================================
            // CONTROL DE AUDIO PARA LA SECCI√ìN DE IMAGEN GRANDE
            // ==============================================
            const imageSectionAudio = document.getElementById('image-section-audio');
            const sectionAudioControlBtn = document.getElementById('sectionAudioControlBtn');
            const audioControlContainer = document.getElementById('audioControlContainer');
            const audioIndicator = document.getElementById('audioIndicator');
            const mainImageSection = document.getElementById('mainImageSection');
            
            let isSectionAudioPlaying = false;
            let audioStarted = false;
            let userInteractedWithPage = false;
            
            console.log("Script loaded - Audio control initialized");
            
            // Funci√≥n para actualizar la apariencia del bot√≥n
            function updateSectionAudioButton() {
                if (isSectionAudioPlaying) {
                    sectionAudioControlBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
                    sectionAudioControlBtn.classList.remove('muted');
                    sectionAudioControlBtn.title = 'Desactivar audio ambiental';
                    audioIndicator.classList.add('visible');
                    
                    // Actualizar texto al lado del bot√≥n
                    const textElement = document.querySelector('.audio-control-text');
                    if (textElement) {
                        textElement.textContent = 'Ambient audio active';
                    }
                } else {
                    sectionAudioControlBtn.innerHTML = '<i class="fas fa-volume-mute"></i>';
                    sectionAudioControlBtn.classList.add('muted');
                    sectionAudioControlBtn.title = 'Activar audio ambiental';
                    audioIndicator.classList.remove('visible');
                    
                    // Actualizar texto al lado del bot√≥n
                    const textElement = document.querySelector('.audio-control-text');
                    if (textElement) {
                        textElement.textContent = 'Activate ambient audio';
                    }
                }
            }
            
            // Funci√≥n para mostrar los controles de audio
            function showAudioControls() {
                audioControlContainer.classList.add('visible');
            }
            
            // Funci√≥n para ocultar los controles de audio
            function hideAudioControls() {
                audioControlContainer.classList.remove('visible');
            }
            
            // Funci√≥n para alternar audio al hacer clic en el bot√≥n
            sectionAudioControlBtn.addEventListener('click', function(e) {
                e.stopPropagation();
                console.log("Audio button clicked, current state:", isSectionAudioPlaying);
                
                if (isSectionAudioPlaying) {
                    imageSectionAudio.pause();
                    isSectionAudioPlaying = false;
                    console.log("Audio paused");
                } else {
                    // Configurar volumen
                    imageSectionAudio.volume = 0.3;
                    imageSectionAudio.play().then(() => {
                        isSectionAudioPlaying = true;
                        console.log("Audio playing successfully");
                    }).catch(error => {
                        console.error("Error playing audio:", error);
                        // Mostrar mensaje para el usuario
                        alert("Para reproducir el audio ambiental, por favor haz clic primero en cualquier parte de la p√°gina");
                    });
                }
                updateSectionAudioButton();
            });
            
            // Funci√≥n para iniciar audio de la secci√≥n autom√°ticamente
            function startSectionAudio() {
                if (imageSectionAudio && !audioStarted && userInteractedWithPage) {
                    console.log("Starting section audio automatically...");
                    
                    // Configurar volumen
                    imageSectionAudio.volume = 0.3;
                    
                    imageSectionAudio.play().then(() => {
                        console.log("Section audio started successfully");
                        isSectionAudioPlaying = true;
                        audioStarted = true;
                        updateSectionAudioButton();
                        showAudioControls();
                    }).catch(error => {
                        console.error("Error starting section audio automatically:", error);
                        // Mostrar controles para que el usuario pueda activarlo manualmente
                        showAudioControls();
                    });
                }
            }
            
            // Detectar cuando el usuario llega a la secci√≥n de imagen grande
            function checkScrollForAudio() {
                if (!audioStarted && userInteractedWithPage) {
                    const rect = mainImageSection.getBoundingClientRect();
                    const windowHeight = window.innerHeight;
                    
                    // Verificar si la secci√≥n est√° visible en la ventana (al menos 40% visible)
                    const sectionTop = rect.top;
                    const sectionBottom = rect.bottom;
                    const sectionHeight = rect.height;
                    
                    // Calcular porcentaje de visibilidad
                    const visibleHeight = Math.min(sectionBottom, windowHeight) - Math.max(sectionTop, 0);
                    const visiblePercentage = (visibleHeight / sectionHeight) * 100;
                    
                    if (visiblePercentage >= 40) {
                        console.log("Section is sufficiently visible (", visiblePercentage.toFixed(1), "%), starting audio");
                        startSectionAudio();
                        // Remover el event listener despu√©s de activar el audio
                        window.removeEventListener('scroll', checkScrollForAudio);
                    }
                }
            }
            
            // Marcar interacci√≥n del usuario con la p√°gina
            function initAudioOnUserInteraction() {
                if (!userInteractedWithPage) {
                    userInteractedWithPage = true;
                    console.log("User interacted with page");
                    
                    // Mostrar controles inmediatamente
                    showAudioControls();
                    
                    // Comenzar a verificar el scroll para activar audio
                    window.addEventListener('scroll', checkScrollForAudio);
                    
                    // Verificar inmediatamente por si ya est√° en la posici√≥n correcta
                    setTimeout(checkScrollForAudio, 100);
                }
            }
            
            // Escuchar interacciones del usuario
            document.addEventListener('click', initAudioOnUserInteraction);
            document.addEventListener('keydown', initAudioOnUserInteraction);
            document.addEventListener('touchstart', initAudioOnUserInteraction);
            
            // Mostrar controles cuando el mouse est√° sobre la secci√≥n
            mainImageSection.addEventListener('mouseenter', function() {
                showAudioControls();
            });
            
            mainImageSection.addEventListener('mouseleave', function() {
                // Solo ocultar si el audio no est√° reproduci√©ndose
                if (!isSectionAudioPlaying) {
                    setTimeout(() => {
                        if (!mainImageSection.matches(':hover')) {
                            hideAudioControls();
                        }
                    }, 1000);
                }
            });
            
            // Verificar visibilidad de controles al hacer scroll
            function checkAudioControlsVisibility() {
                const rect = mainImageSection.getBoundingClientRect();
                const windowHeight = window.innerHeight;
                
                // Mostrar controles si la secci√≥n est√° visible
                if (rect.top < windowHeight && rect.bottom > 0) {
                    showAudioControls();
                } else if (!isSectionAudioPlaying) {
                    // Ocultar controles si la secci√≥n no es visible y el audio no est√° activo
                    hideAudioControls();
                }
            }
            
            // Verificar visibilidad al cargar
            setTimeout(checkAudioControlsVisibility, 500);
            
            // Verificar visibilidad de controles al hacer scroll
            window.addEventListener('scroll', checkAudioControlsVisibility);
            
            // Manejar cuando el audio termina o tiene errores
            imageSectionAudio.addEventListener('ended', function() {
                console.log("Audio ended");
                isSectionAudioPlaying = false;
                updateSectionAudioButton();
            });
            
            imageSectionAudio.addEventListener('error', function(e) {
                console.error("Audio error:", e);
                isSectionAudioPlaying = false;
                updateSectionAudioButton();
            });
            
            // Inicializar el bot√≥n (audio apagado al inicio)
            updateSectionAudioButton();
            
            // ==============================================
            // C√ìDIGO EXISTENTE PARA TOOLTIPS Y CARRUSEL
            // ==============================================
            const markers = document.querySelectorAll('.marker');
            const closeButtons = document.querySelectorAll('.tooltip-close');
            
            // Funci√≥n para abrir tooltip
            function openTooltip(marker) {
                // Cerrar cualquier tooltip abierto
                document.querySelectorAll('.tooltip.active').forEach(tooltip => {
                    tooltip.classList.remove('active');
                });
                
                // Abrir el tooltip del marcador clickeado
                const tooltip = marker.querySelector('.tooltip');
                tooltip.classList.add('active');
                
                // Ajustar posici√≥n si se sale de la ventana
                adjustTooltipPosition(marker, tooltip);
            }
            
            // Funci√≥n para ajustar posici√≥n del tooltip
            function adjustTooltipPosition(marker, tooltip) {
                const markerRect = marker.getBoundingClientRect();
                const tooltipRect = tooltip.getBoundingClientRect();
                
                // Resetear estilos de posici√≥n
                tooltip.style.left = '';
                tooltip.style.right = '';
                tooltip.style.top = '';
                tooltip.style.bottom = '';
                
                // Posici√≥n por defecto: derecha y centrado verticalmente
                tooltip.style.left = '50px';
                tooltip.style.top = '50%';
                tooltip.style.transform = 'translateY(-50%)';
                
                // Verificar si el tooltip se sale por la derecha
                const spaceRight = window.innerWidth - markerRect.right;
                if (spaceRight < tooltipRect.width + 50) {
                    tooltip.style.left = '';
                    tooltip.style.right = '50px';
                }
                
                // Verificar si el tooltip se sale por arriba
                if (markerRect.top - tooltipRect.height / 2 < 10) {
                    tooltip.style.top = '0';
                    tooltip.style.transform = 'translateY(0)';
                }
                
                // Verificar si el tooltip se sale por abajo
                if (markerRect.bottom + tooltipRect.height / 2 > window.innerHeight - 10) {
                    tooltip.style.top = 'auto';
                    tooltip.style.bottom = '0';
                    tooltip.style.transform = 'translateY(0)';
                }
            }
            
            // Event listeners para marcadores
            markers.forEach(marker => {
                marker.addEventListener('click', function(e) {
                    e.stopPropagation();
                    openTooltip(this);
                });
            });
            
            // Event listeners para botones de cierre
            closeButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    e.stopPropagation();
                    this.closest('.tooltip').classList.remove('active');
                });
            });
            
            // Cerrar tooltips al hacer clic fuera
            document.addEventListener('click', function() {
                document.querySelectorAll('.tooltip.active').forEach(tooltip => {
                    tooltip.classList.remove('active');
                });
            });
            
            // Cerrar tooltips con tecla Escape
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    document.querySelectorAll('.tooltip.active').forEach(tooltip => {
                        tooltip.classList.remove('active');
                    });
                }
            });
            
            // Ajustar tooltips al redimensionar ventana
            window.addEventListener('resize', function() {
                document.querySelectorAll('.tooltip.active').forEach(tooltip => {
                    const marker = tooltip.closest('.marker');
                    adjustTooltipPosition(marker, tooltip);
                });
            });
            
            // Configurar el carrusel para cambiar autom√°ticamente cada 5 segundos
            const statsCarousel = document.getElementById('statsCarousel');
            if (statsCarousel) {
                const carousel = new bootstrap.Carousel(statsCarousel, {
                    interval: 5000, // Cambia cada 5 segundos
                    wrap: true
                });
            }
        });
    </script>
</body>
</html>